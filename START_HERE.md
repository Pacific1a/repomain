# üöÄ –ù–ê–ß–ù–ò –û–¢–°–Æ–î–ê - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û

–í—Å–µ –ø–∞—Ç—á–∏ **–£–ñ–ï –ü–†–ò–ú–ï–ù–ï–ù–´** –∫ —Ç–≤–æ–∏–º —Ñ–∞–π–ª–∞–º:
- ‚úÖ `bot/server/server.js` - –¥–æ–±–∞–≤–ª–µ–Ω —Ç—Ä–µ–∫–∏–Ω–≥ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- ‚úÖ `site/server/server.js` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ API
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –º–æ–¥—É–ª–∏: `partner-webhook.js` –∏ `referral-tracker.js`
- ‚úÖ –ì–æ—Ç–æ–≤—ã–µ `.env` —Ñ–∞–π–ª—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

---

## üîë –ü–†–û –ö–õ–Æ–ß (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï!)

### –ß—Ç–æ –∑–∞ PARTNER_API_SECRET?

–≠—Ç–æ **–æ–±—â–∏–π –ø–∞—Ä–æ–ª—å** –º–µ–∂–¥—É –±–æ—Ç–æ–º –∏ —Å–∞–π—Ç–æ–º.

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:**
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–∞–π—Ç
- –í–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å
- –°–∞–π—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä–æ–ª—å
- –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ‚Üí –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ‚Üí –æ—Ç–∫–ª–æ–Ω—è–µ—Ç (401 –æ—à–∏–±–∫–∞)

### –ì–¥–µ —É–∫–∞–∑–∞—Ç—å?

**–í –û–ë–û–ò–• –º–µ—Å—Ç–∞—Ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –û–î–ò–ù–ê–ö–û–í–´–ô:**

```
bot/server/.env:
PARTNER_API_SECRET=duo-secret-key-2024-xyz

site/server/.env:
PARTNER_API_SECRET=duo-secret-key-2024-xyz  ‚Üê –¢–ê–ö–û–ô –ñ–ï!
```

---

## üìù –®–ê–ì 1: –ù–∞—Å—Ç—Ä–æ–π .env —Ñ–∞–π–ª—ã

### –î–ª—è –ë–û–¢–ê (`bot/server/.env`):

–§–∞–π–ª —É–∂–µ —Å–æ–∑–¥–∞–Ω! –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π –∏ –ø—Ä–æ–≤–µ—Ä—å:

```env
# URL —Å–∞–π—Ç–∞ (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –Ω–∞ Render)
PARTNER_SITE_URL=http://localhost:3001

# –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–ø—Ä–∏–¥—É–º–∞–π —Å–≤–æ–π!)
PARTNER_API_SECRET=—Ç–≤–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á
```

**–ú–æ–∂–µ—à—å –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞!**

---

### –î–ª—è –°–ê–ô–¢–ê (`site/server/.env`):

–§–∞–π–ª —É–∂–µ —Å–æ–∑–¥–∞–Ω! –ü—Ä–æ–≤–µ—Ä—å:

```env
# –ü–æ—Ä—Ç
PORT=3001

# JWT (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤)
JWT_SECRET=any-secret-key

# –í–ê–ñ–ù–û: –¢–∞–∫–æ–π –∂–µ –∫–ª—é—á –∫–∞–∫ –≤ –±–æ—Ç–µ!
PARTNER_API_SECRET=—Ç–≤–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á

# Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞)
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-password
```

---

## üöÄ –®–ê–ì 2: –ó–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä—ã

### –õ–æ–∫–∞–ª—å–Ω–æ (–¥–ª—è —Ç–µ—Å—Ç–∞):

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 - –ë–û–¢:**
```bash
cd bot/server
npm install
npm start
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ Referral tracker initialized
‚úÖ Partner Webhook enabled: http://localhost:3001
üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000
```

---

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 - –°–ê–ô–¢:**
```bash
cd site/server
npm install
npm start
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ SQLite –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
Server running on http://localhost:3001
```

---

## üß™ –®–ê–ì 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π

### –¢–µ—Å—Ç 1: –û—Ç–∫—Ä–æ–π –±–æ—Ç —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π

```
http://localhost:3000/?tgWebAppStartParam=ref_test123
```

**–û–∂–∏–¥–∞–µ–º–æ –≤ –ª–æ–≥–∞—Ö –ë–û–¢–ê:**
```
üîó Start param detected: ref_test123
‚úÖ User 123456 linked to partner test123
```

**–û–∂–∏–¥–∞–µ–º–æ –≤ –ª–æ–≥–∞—Ö –°–ê–ô–¢–ê:**
```
‚úÖ Webhook authenticated
POST /api/referral/click 200
```

---

### –¢–µ—Å—Ç 2: –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∫–æ–Ω—Å–æ–ª—å (F12) –∏ –≤—ã–ø–æ–ª–Ω–∏:

```javascript
fetch('http://localhost:3000/api/balance/123456', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ rubles: 1000, chips: 0 })
});
```

**–û–∂–∏–¥–∞–µ–º–æ –≤ –ª–æ–≥–∞—Ö –ë–û–¢–ê:**
```
üí∞ Deposit tracked: 123456 - 1000‚ÇΩ
üéâ First deposit for user 123456
```

**–û–∂–∏–¥–∞–µ–º–æ –≤ –ª–æ–≥–∞—Ö –°–ê–ô–¢–ê:**
```
‚úÖ Webhook authenticated
POST /api/referral/register-referral 200
```

---

## üåê –®–ê–ì 4: –î–µ–ø–ª–æ–π –Ω–∞ Render (–∫–æ–≥–¥–∞ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ)

### –î–ª—è –ë–û–¢–ê:

1. –û—Ç–∫—Ä–æ–π Render Dashboard
2. –¢–≤–æ–π —Å–µ—Ä–≤–∏—Å –±–æ—Ç–∞
3. Environment Variables
4. –î–æ–±–∞–≤—å:

```
PARTNER_SITE_URL = https://duo-site.onrender.com
PARTNER_API_SECRET = —Ç–≤–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á
```

5. Deploy

---

### –î–ª—è –°–ê–ô–¢–ê:

1. Render Dashboard
2. –¢–≤–æ–π —Å–µ—Ä–≤–∏—Å —Å–∞–π—Ç–∞
3. Environment Variables
4. –î–æ–±–∞–≤—å:

```
PARTNER_API_SECRET = —Ç–≤–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á  (–¢–ê–ö–û–ô –ñ–ï!)
JWT_SECRET = –¥—Ä—É–≥–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á
```

5. Deploy

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ß–¢–û –í–°–Å –†–ê–ë–û–¢–ê–ï–¢

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏:

### –ù–∞ –ë–û–¢–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ Referral tracker initialized
üìä Tracked users: 0
‚úÖ Partner Webhook enabled: https://duo-site.onrender.com
```

### –ù–∞ –°–ê–ô–¢–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ SQLite –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
Server running on http://localhost:3001
```

### –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ:
```
–ë–û–¢: üîó Start param detected: ref_XXX
–ë–û–¢: ‚úÖ Webhook success [/api/referral/click]
–°–ê–ô–¢: ‚úÖ Webhook authenticated
–°–ê–ô–¢: POST /api/referral/click 200
```

---

## ‚ùì –ü–†–û–ë–õ–ï–ú–´?

### 401 Unauthorized
**–ü—Ä–∏—á–∏–Ω–∞:** –ö–ª—é—á–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `PARTNER_API_SECRET` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π

### Webhook disabled
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ —É–∫–∞–∑–∞–Ω `PARTNER_SITE_URL`  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å –≤ `.env` –±–æ—Ç–∞

### Cannot find module 'referral-tracker'
**–ü—Ä–∏—á–∏–Ω–∞:** –ú–æ–¥—É–ª—å –Ω–µ –≤ –Ω—É–∂–Ω–æ–π –ø–∞–ø–∫–µ  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ–∞–π–ª—ã –≤ `bot/server/`

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û

- **KEYS_EXPLAINED.md** - –ø–æ–¥—Ä–æ–±–Ω–æ –ø—Ä–æ –∫–ª—é—á–∏
- **INTEGRATION_GUIDE.md** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- **INTEGRATION_PATCHES.md** - –∫–∞–∫–∏–µ –ø–∞—Ç—á–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

---

## üéâ –ì–û–¢–û–í–û!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

‚úÖ –ü–∞—Ä—Ç–Ω–µ—Ä —Å–æ–∑–¥–∞–µ—Ç —Ä–µ—Ñ. —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∞–π—Ç–µ  
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç ‚Üí —Å–∞–π—Ç –≤–∏–¥–∏—Ç –∫–ª–∏–∫  
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–æ–ª–Ω—è–µ—Ç ‚Üí —Å–∞–π—Ç –≤–∏–¥–∏—Ç –¥–µ–ø–æ–∑–∏—Ç  
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç ‚Üí –ø–∞—Ä—Ç–Ω–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç %  

**–í–°–Å –†–ê–ë–û–¢–ê–ï–¢ –ë–ï–ó –û–ë–™–ï–î–ò–ù–ï–ù–ò–Ø –°–ï–†–í–ï–†–û–í!** üöÄ

–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –Ω–∞ —Å–≤–æ–µ–º —Ö–æ—Å—Ç–µ, –æ–±—â–∞—é—Ç—Å—è –ø–æ HTTP.
