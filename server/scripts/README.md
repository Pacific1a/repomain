# Duo Partners - Scripts

–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π.

---

## üîÑ Backup & Restore

### –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø

```bash
node scripts/backup.js [output-dir]
```

Example:
```bash
# Default location (../backups/)
node scripts/backup.js

# Custom location
node scripts/backup.js /home/backups
```

**–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è:**
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (database.db)
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (.env)
- ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (package.json)
- ‚úÖ –ê—Ä—Ö–∏–≤ –ø—Ä–æ–µ–∫—Ç–∞ (.tar.gz)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:** —Ö—Ä–∞–Ω–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –±—ç–∫–∞–ø–æ–≤

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞

```bash
node scripts/restore.js <backup-path>
```

Example:
```bash
node scripts/restore.js ../backups/duo-backup-2026-01-01T12-00-00
```

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –ë–î –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º!

### –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. [BACKUP_GUIDE.md](./BACKUP_GUIDE.md) –¥–ª—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ cron
- –£–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üîê Scripts –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è 2FA

## –û—á–∏—Å—Ç–∫–∞ 2FA –¥–∞–Ω–Ω—ã—Ö

### 1. –û—á–∏—Å—Ç–∏—Ç—å 2FA –¥–ª—è –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```bash
cd /var/www/duo/server
node scripts/clear-2fa.js
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: `two_factor_secret = NULL`
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: `two_factor_enabled = 0`

---

### 2. –û—á–∏—Å—Ç–∏—Ç—å 2FA –¥–ª—è –ö–û–ù–ö–†–ï–¢–ù–û–ì–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
cd /var/www/duo/server
node scripts/clear-2fa-user.js <USER_ID>
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID = 4
node scripts/clear-2fa-user.js 4
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –£–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `two_factor_secret = NULL`
- –£–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `two_factor_enabled = 0`

---

## –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:
```bash
pm2 restart duo-server
```

2. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ (Ctrl+Shift+R)

3. –û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 2FA ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å 2FA"

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å 2FA –≤ –ª–æ–≥–∞—Ö
pm2 logs duo-server | grep "2FA Status"

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# üìã 2FA Status check: { userId: 4, enabled: false, hasSecret: false }
```
