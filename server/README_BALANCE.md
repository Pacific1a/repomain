# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É –±–æ—Ç–æ–º –∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

## üéØ –†–µ—à–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
- –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (–æ—Ç–ª–∏—á–∞–ª—Å—è –æ—Ç –±–æ—Ç–∞)
- –ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –±–æ—Ç–∞ –±–∞–ª–∞–Ω—Å —Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è 0
- –ù–µ –±—ã–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –±–æ—Ç–æ–º Telegram –∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–°–µ—Ä–≤–µ—Ä —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–µ–¥–∏–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** - —á–∏—Ç–∞–µ—Ç –±–∞–ª–∞–Ω—Å –Ω–∞–ø—Ä—è–º—É—é –∏–∑ SQLite –±–∞–∑—ã –±–æ—Ç–∞.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
```bash
cd server
npm install
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
npm start
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏–∑ –±–∞–∑—ã –±–æ—Ç–∞
node test-balance.js

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoint
curl http://localhost:3000/api/balance/–í–ê–®_TELEGRAM_ID
```

## üì° API Endpoints

### GET `/api/balance/:telegramId`
–ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl http://localhost:3000/api/balance/1889923046
# –û—Ç–≤–µ—Ç: {"rubles":400,"chips":0}
```

### POST `/api/balance/:telegramId`
–û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl -X POST http://localhost:3000/api/balance/1889923046 \
  -H "Content-Type: application/json" \
  -d '{"rubles": 500, "chips": 0}'
```

### POST `/api/balance/:telegramId/add`
–î–æ–±–∞–≤–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –∫ –±–∞–ª–∞–Ω—Å—É
```bash
curl -X POST http://localhost:3000/api/balance/1889923046/add \
  -H "Content-Type: application/json" \
  -d '{"rubles": 100, "chips": 0}'
```

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

1. **–ë–æ—Ç –∏–∑–º–µ–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å** ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ SQLite –±–∞–∑—É
2. **–°–µ—Ä–≤–µ—Ä —á–∏—Ç–∞–µ—Ç –±–∞–ª–∞–Ω—Å** ‚Üí –±–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–æ–π –∂–µ SQLite –±–∞–∑—ã
3. **–ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å** ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API
4. **WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ø–æ –ø–æ—Ä—è–¥–∫—É):
1. **SQLite –±–∞–∑–∞ –±–æ—Ç–∞** (–æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫)
   - –ü—É—Ç—å: `../autoshop/tgbot/data/database.db`
   - –¢–∞–±–ª–∏—Ü–∞: `storage_users`
   - –ü–æ–ª–µ: `user_balance`

2. **MongoDB** (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback, –µ—Å–ª–∏ –±–∞–∑–∞ –±–æ—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

3. **JSON —Ñ–∞–π–ª** (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
   - –ü—É—Ç—å: `server/data/balances.json`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –±–æ—Ç–∞ –∏ MongoDB

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ï—Å–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ, –∏–∑–º–µ–Ω–∏—Ç–µ –ø—É—Ç—å –≤ `server.js`:

```javascript
const BOT_DB_PATH = path.join(__dirname, '..', 'autoshop', 'tgbot', 'data', 'database.db');
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- **–ë–∞–∑–∞ –±–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞** –¥–ª—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏
- **–ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ë–æ—Ç –∏ —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** - –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–ª–∞–Ω—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
Test-Path "C:\Users\dev_fenomen\Desktop\bot\autoshop\tgbot\data\database.db"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
node test-balance.js
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `miniapp-balance-sync.js` –∑–∞–≥—Ä—É–∂–µ–Ω
4. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞

## üìä –õ–æ–≥–∏

–°–µ—Ä–≤–µ—Ä –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:
- `üí∞ Balance loaded from bot DB` - –±–∞–ª–∞–Ω—Å –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ –±–∞–∑—ã –±–æ—Ç–∞
- `üí∞ Balance updated in bot DB` - –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –±–∞–∑–µ –±–æ—Ç–∞
- `‚ö†Ô∏è Bot database not found` - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (–±–∞–∑–∞ –±–æ—Ç–∞)  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è  
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º –±–æ—Ç–µ  
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ WebSocket  
‚úÖ Fallback –Ω–∞ MongoDB/JSON –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏  
