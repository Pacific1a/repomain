# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –±–∞–ª–∞–Ω—Å–æ–≤ - –ó–ê–í–ï–†–®–ï–ù–û

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
- –ë—ã–ª–æ **3 —Ä–∞–∑–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã –±–∞–ª–∞–Ω—Å–æ–≤** (global-balance.js, game-balance-api.js, miniapp-balance-sync.js)
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ë–∞–ª–∞–Ω—Å –ø–æ–∫–∞–∑—ã–≤–∞–ª 0 –∫–æ–≥–¥–∞ –±–æ—Ç –≤—ã–∫–ª—é—á–µ–Ω
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π ID –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Telegram ID

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–°–æ–∑–¥–∞–Ω–∞ **–µ–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–∞–ª–∞–Ω—Å–∞** —á–µ—Ä–µ–∑ API —Å–µ—Ä–≤–µ—Ä–∞:
- **1 —Ñ–∞–π–ª** –≤–º–µ—Å—Ç–æ 3: `balance-api.js`
- **1 –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞ (SQLite)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** —á–µ—Ä–µ–∑ WebSocket
- **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Telegram ID** –∏–∑ Telegram WebApp API

## üìù –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –°–æ–∑–¥–∞–Ω `balance-api.js`
- –ï–¥–∏–Ω—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–ª–∞–Ω—Å–æ–º
- –†–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä (–±–µ–∑ localStorage/CloudStorage)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞
- WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### 2. –û–±–Ω–æ–≤–ª–µ–Ω —Å–µ—Ä–≤–µ—Ä (`server/server.js`)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `better-sqlite3`
- –°–µ—Ä–≤–µ—Ä —á–∏—Ç–∞–µ—Ç –±–∞–ª–∞–Ω—Å –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –±–∞–∑—ã –±–æ—Ç–∞
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: SQLite –±–æ—Ç–∞ ‚Üí MongoDB ‚Üí JSON fallback

### 3. –û–±–Ω–æ–≤–ª–µ–Ω `index.html`
```diff
- <script src="global-balance.js"></script>
- <script src="game-balance-api.js"></script>
- <script src="miniapp-balance-sync.js"></script>
+ <script src="balance-api.js"></script>
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω—ã –í–°–ï –∏–≥—Ä—ã
- ‚úÖ –ö–µ–π—Å—ã (main/case-opener.js)
- ‚úÖ BlackJack (BlackJack/game.js)
- ‚úÖ Crash (crash/crash-websocket.js)
- ‚úÖ Roll (roll/wheel-game.js)
- ‚úÖ SpeedCASH (speedCASH/game_fixed.js)
- ‚úÖ Mines (mine/script.js)
- ‚úÖ Swap (swap/swap-converter.js)

### 5. –°–æ–∑–¥–∞–Ω backup
–°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `OLD_BALANCE_BACKUP/`

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```bash
cd server
npm install  # –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
npm start
```

### 2. –û—Ç–∫—Ä—ã—Ç—å –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
–¢–µ–ø–µ—Ä—å –±–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç **–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω** —Å –±–æ—Ç–æ–º!

## üìö API

### –°—Ç–∞—Ä—ã–π –∫–æ–¥ (–±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):
```javascript
window.GlobalBalance.addRubles(100);
window.GameBalanceAPI.canPlaceBet(50, 'rubles');
```

### –ù–æ–≤—ã–π –∫–æ–¥ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ):
```javascript
window.BalanceAPI.addRubles(100);
window.BalanceAPI.hasEnoughRubles(50);
await window.BalanceAPI.subtractRubles(50);
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
showBalance()  // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
addMoney(100, 50)  // –î–æ–±–∞–≤–∏—Ç—å 100‚ÇΩ –∏ 50 —Ñ–∏—à–µ–∫ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram ID:
```javascript
console.log(window.BalanceAPI.telegramId)
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:
```javascript
console.log(window.BalanceAPI.socket?.connected)
```

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
bot/
‚îú‚îÄ‚îÄ balance-api.js                 ‚Üê –ù–û–í–´–ô –µ–¥–∏–Ω—ã–π API
‚îú‚îÄ‚îÄ index.html                      ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç balance-api.js)
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ server.js                   ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω (—á–∏—Ç–∞–µ—Ç –∏–∑ –±–∞–∑—ã –±–æ—Ç–∞)
‚îÇ   ‚îî‚îÄ‚îÄ test-balance.js             ‚Üê –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ main/case-opener.js             ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ BlackJack/game.js               ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ crash/crash-websocket.js        ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ roll/wheel-game.js              ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ speedCASH/game_fixed.js         ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ mine/script.js                  ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ swap/swap-converter.js          ‚Üê –û–±–Ω–æ–≤–ª–µ–Ω
‚îî‚îÄ‚îÄ OLD_BALANCE_BACKUP/             ‚Üê Backup —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
    ‚îú‚îÄ‚îÄ global-balance.js
    ‚îú‚îÄ‚îÄ game-balance-api.js
    ‚îî‚îÄ‚îÄ miniapp-balance-sync.js
```

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **UNIFIED_BALANCE_API.md** - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–æ–≤–æ–≥–æ API
- **BALANCE_SYNC_FIX.md** - –û–ø–∏—Å–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –±–æ—Ç–æ–º
- **server/README_BALANCE.md** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞  
‚úÖ **–ù–∏–∫–∞–∫–∏—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** - –æ–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –≤–º–µ—Å—Ç–æ —Ç—Ä–µ—Ö  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - WebSocket + –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è  
‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º –±–æ—Ç–µ** - —á–∏—Ç–∞–µ—Ç –∏–∑ –±–∞–∑—ã SQLite  
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Telegram ID** - –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API  
‚úÖ **–í—Å–µ –∏–≥—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π API  
‚úÖ **–ü—Ä–æ—Å—Ç–æ–π –∫–æ–¥** - –ø–æ–Ω—è—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã (addRubles, subtractRubles, etc.)

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: `cd server && npm start`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram ID: `console.log(window.BalanceAPI.telegramId)`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞: `cd server && node test-balance.js`
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ –±–∞–∑–µ –±–æ—Ç–∞ –≤ `server/server.js`:
   ```javascript
   const BOT_DB_PATH = path.join(__dirname, '..', 'autoshop', 'tgbot', 'data', 'database.db');
   ```

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –±–∞–ª–∞–Ω—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –±–æ—Ç–æ–º –∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
