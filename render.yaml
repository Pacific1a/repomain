# ============================================
# RENDER CONFIGURATION
# Автоматическая настройка двух сервисов
# ============================================

services:
  # ============================================
  # СЕРВИС 1: БОТ (Telegram Mini App)
  # ============================================
  - type: web
    name: duo-bot
    runtime: node
    region: frankfurt
    plan: free
    rootDir: bot/server
    buildCommand: npm install
    startCommand: npm start
    
    envVars:
      - key: PORT
        value: 10000
      
      - key: PARTNER_SITE_URL
        value: https://duo-site.onrender.com
      
      - key: PARTNER_API_SECRET
        generateValue: true
        sync: true  # Синхронизируется между сервисами
      
      - key: MONGODB_URI
        value: ""
      
      - key: API_SECRET
        generateValue: true
    
    autoDeploy: true

  # ============================================
  # СЕРВИС 2: САЙТ (Партнерская программа)
  # ============================================
  - type: web
    name: duo-site
    runtime: node
    region: frankfurt
    plan: free
    rootDir: site/server
    buildCommand: npm install
    startCommand: npm start
    
    envVars:
      - key: PORT
        value: 10000
      
      - key: JWT_SECRET
        generateValue: true
      
      - key: PARTNER_API_SECRET
        sync: true  # Синхронизируется с ботом
      
      - key: SITE_URL
        value: https://duo-site.onrender.com
      
      - key: EMAIL_HOST
        value: smtp.gmail.com
      
      - key: EMAIL_PORT
        value: 587
      
      - key: EMAIL_USER
        value: your-email@gmail.com
      
      - key: EMAIL_PASS
        value: your-app-password
      
      - key: EMAIL_FROM
        value: "DUO Partners <noreply@duopartners.com>"
    
    autoDeploy: true

# ============================================
# ИНСТРУКЦИЯ ПО ИСПОЛЬЗОВАНИЮ
# ============================================
#
# 1. Добавь этот файл в корень репозитория (duo/render.yaml)
#
# 2. Закоммить и запушь:
#    git add render.yaml
#    git commit -m "Add Render configuration"
#    git push
#
# 3. В Render Dashboard:
#    - New + → Blueprint
#    - Подключи репозиторий
#    - Render автоматически создаст оба сервиса!
#
# 4. После деплоя:
#    - Открой Environment Variables каждого сервиса
#    - Проверь что PARTNER_API_SECRET одинаковый
#    - Обнови PARTNER_SITE_URL в боте на реальный URL
#
# ============================================
