# üöÄ –§–ò–ù–ê–õ–¨–ù–´–ô –î–ï–ü–õ–û–ô - –ü–û–õ–ù–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø

## üìã –°–ü–ò–°–û–ö –ò–ó–ú–ï–ù–ï–ù–ò–ô:

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (data mapping)
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ 429 Too Many Requests (rate limit + interval)
3. ‚úÖ –ë–∞–ª–∞–Ω—Å —Ç–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ Python –ë–î (–Ω–µ –ø—Ä–æ–ø–∞–¥–∞–µ—Ç)
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ getUserReferrer() –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è referrer_code
5. ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ user_referrer
6. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –≤ Python –±–æ—Ç–µ

---

## üöÄ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –î–ï–ü–õ–û–Ø (–í–´–ü–û–õ–ù–ò–¢–¨ –ü–û –ü–û–†–Ø–î–ö–£):

### –®–ê–ì 1: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ —Å GitHub

```bash
cd /var/www/duo
git pull origin main
```

### –®–ê–ì 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î (–í–ê–ñ–ù–û!)

```bash
cd /var/www/duo/bot/autoshop
python3 add_referrer_column.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
============================================================
üîß –ú–ò–ì–†–ê–¶–ò–Ø –ë–î: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ user_referrer
============================================================

üìÇ –ü—É—Ç—å –∫ –ë–î: tgbot/data/database.db
üìä –¢–µ–∫—É—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏: increment, user_id, user_login, user_name, user_balance, user_refill, user_give, user_unix
‚ûï –î–æ–±–∞–≤–ª—è—é –∫–æ–ª–æ–Ω–∫—É user_referrer...
‚úÖ –ö–æ–ª–æ–Ω–∫–∞ user_referrer —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!

============================================================
‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!
============================================================
```

### –®–ê–ì 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Node.js —Å–µ—Ä–≤–µ—Ä
pm2 restart duo-server

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Python –±–æ—Ç–∞
pm2 restart duo-bot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
pm2 status
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id ‚îÇ name       ‚îÇ version ‚îÇ mode    ‚îÇ pid      ‚îÇ uptime ‚îÇ ‚Ü∫    ‚îÇ status    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0  ‚îÇ duo-server ‚îÇ 2.0.0   ‚îÇ fork    ‚îÇ XXXXXX   ‚îÇ Xs     ‚îÇ XX   ‚îÇ online    ‚îÇ
‚îÇ 1  ‚îÇ duo-bot    ‚îÇ N/A     ‚îÇ fork    ‚îÇ XXXXXX   ‚îÇ Xs     ‚îÇ XXX  ‚îÇ online    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

```bash
pm2 logs --lines 20
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ë–ï–ó –æ—à–∏–±–æ–∫:**
- ‚úÖ `‚úÖ SERVER IS RUNNING`
- ‚úÖ `~~~~~ Bot was started - @aasasdasdadsddasdbot ~~~~~`

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´:

### –¢–ï–°–¢ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ –ø–∞—Ä—Ç–Ω—ë—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (Ctrl+F5 –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞):
   ```
   https://duopartners.xyz/dashboard/
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12):
   ```javascript
   ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   üìä –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: {clicks: 4, ...}
   üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {clicks: 4, ...}
   ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ .visits-value = 4
   
   ‚ùå –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   429 Too Many Requests
   Failed to fetch
   ```

3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å:**
   - –ü–µ—Ä–µ—Ö–æ–¥—ã: **4** (–∏–ª–∏ –±–æ–ª—å—à–µ)
   - –ü–µ—Ä–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã: **0** (–ø–æ–∫–∞)
   - –î–µ–ø–æ–∑–∏—Ç—ã: **0** (–ø–æ–∫–∞)

### –¢–ï–°–¢ 2: –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ

–í Telegram –±–æ—Ç–µ:
```
/start ref_4_MJQ22TV3PNI5J
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üéÅ –í—ã –ø–µ—Ä–µ—à–ª–∏ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ!
–í–∞—à –ø–∞—Ä—Ç–Ω—ë—Ä –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å 60% –æ—Ç –≤–∞—à–∏—Ö –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π.
```

**–í –ª–æ–≥–∞—Ö –±–æ—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚úÖ Referral registered: XXXXXX -> 4
üíæ Saved referrer code '4_MJQ22TV3PNI5J' for user XXXXXX
```

### –¢–ï–°–¢ 3: –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (–ø–µ—Ä–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç)

–í Telegram –±–æ—Ç–µ:
```
/test_balance
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üß™ –¢–ï–°–¢: –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω!
‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ: 10000‚ÇΩ
üí∞ –¢–µ–ø–µ—Ä—å –±–∞–ª–∞–Ω—Å: 10000‚ÇΩ
‚úÖ Mini App –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω!
```

**–í –ª–æ–≥–∞—Ö –±–æ—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚úÖ First deposit registered: XXXXXX ‚Üí 10000‚ÇΩ
```

**–í –¥–∞—à–±–æ—Ä–¥–µ –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è:**
- –ü–µ—Ä–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã: **1** ‚úÖ
- –î–µ–ø–æ–∑–∏—Ç—ã: **1** ‚úÖ
- –°—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤: **10000‚ÇΩ** ‚úÖ

### –¢–ï–°–¢ 4: –ü—Ä–æ–∏–≥—Ä—ã—à –≤ –∏–≥—Ä–µ (60% –ø–∞—Ä—Ç–Ω—ë—Ä—É)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Mini App
2. –ó–∞–π–¥–∏—Ç–µ –≤ –ª—é–±—É—é –∏–≥—Ä—É
3. –ü—Ä–æ–∏–≥—Ä–∞–π—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –¥–µ–Ω–µ–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä 100‚ÇΩ)

**–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
üíæ Found referrer for XXXXXX: 4_MJQ22TV3PNI5J
‚úÖ Earnings added: loss=100‚ÇΩ, partner_gets=60‚ÇΩ (60%)
```

**–í –¥–∞—à–±–æ—Ä–¥–µ –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è:**
- –î–æ—Ö–æ–¥ –ø–∞—Ä—Ç–Ω—ë—Ä–∞: **60‚ÇΩ** ‚úÖ

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê:

–ü–æ—Å–ª–µ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤ –¥–∞—à–±–æ—Ä–¥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
‚úÖ –ü–µ—Ä–µ—Ö–æ–¥—ã: 5+ (–º–∏–Ω–∏–º—É–º 4)
‚úÖ –ü–µ—Ä–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã: 1+
‚úÖ –î–µ–ø–æ–∑–∏—Ç—ã: 1+
‚úÖ –°—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤: 10000‚ÇΩ+
‚úÖ –î–æ—Ö–æ–¥ –ø–∞—Ä—Ç–Ω—ë—Ä–∞: 60‚ÇΩ+ (–µ—Å–ª–∏ –ø—Ä–æ–∏–≥—Ä–∞–ª –≤ –∏–≥—Ä–µ)
```

---

## üîß –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: user_referrer –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞
cd /var/www/duo/bot/autoshop
python3 << 'EOF'
import sqlite3
from tgbot.data.config import PATH_DATABASE
con = sqlite3.connect(PATH_DATABASE)
cursor = con.cursor()
cursor.execute("PRAGMA table_info(storage_users)")
columns = [col[1] for col in cursor.fetchall()]
print("–ö–æ–ª–æ–Ω–∫–∏:", columns)
print("user_referrer –µ—Å—Ç—å?", "user_referrer" in columns)
con.close()
EOF
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –î–µ–ø–æ–∑–∏—Ç—ã –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
pm2 logs duo-bot --lines 50 | grep -i "deposit\|referral"

# –ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ user_referrer —Å–æ—Ö—Ä–∞–Ω—ë–Ω
python3 << 'EOF'
import sqlite3
from tgbot.data.config import PATH_DATABASE
con = sqlite3.connect(PATH_DATABASE)
cursor = con.cursor()
cursor.execute("SELECT user_id, user_referrer FROM storage_users WHERE user_referrer IS NOT NULL")
rows = cursor.fetchall()
print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å referrer: {len(rows)}")
for row in rows:
    print(f"  user_id={row[0]}, referrer={row[1]}")
con.close()
EOF
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ë–∞–ª–∞–Ω—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—É—Ç—å –∫ –ë–î –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
cd /var/www/duo/server
node << 'EOF'
const path = require('path');
const fs = require('fs');
const BOT_DB_PATH = path.join(__dirname, '../bot/autoshop/tgbot/data/database.db');
console.log('–ü—É—Ç—å –∫ –ë–î:', BOT_DB_PATH);
console.log('–§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?', fs.existsSync(BOT_DB_PATH));
EOF
```

---

## üìù –ö–û–ú–ê–ù–î–ê –î–õ–Ø –ë–´–°–¢–†–û–ô –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò:

```bash
echo "=== PM2 STATUS ==="
pm2 status

echo -e "\n=== –ú–ò–ì–†–ê–¶–ò–Ø –ë–î ==="
cd /var/www/duo/bot/autoshop
python3 add_referrer_column.py

echo -e "\n=== –ü–†–û–í–ï–†–ö–ê REFERRER ==="
python3 << 'EOF'
import sqlite3
from tgbot.data.config import PATH_DATABASE
con = sqlite3.connect(PATH_DATABASE)
cursor = con.cursor()
cursor.execute("SELECT user_id, user_referrer FROM storage_users WHERE user_referrer IS NOT NULL LIMIT 5")
rows = cursor.fetchall()
print(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å referrer: {len(rows)}")
for row in rows:
    print(f"   user_id={row[0]}, referrer={row[1]}")
con.close()
EOF

echo -e "\n=== –õ–û–ì–ò –°–ï–†–í–ï–†–ê (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫) ==="
pm2 logs duo-server --lines 10 --nostream

echo -e "\n=== –õ–û–ì–ò –ë–û–¢–ê (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫) ==="
pm2 logs duo-bot --lines 10 --nostream
```

---

**–í–´–ü–û–õ–ù–ò–¢–ï –í–°–ï –ö–û–ú–ê–ù–î–´ –ü–û –ü–û–†–Ø–î–ö–£ –ò –ü–û–ö–ê–ñ–ò–¢–ï –†–ï–ó–£–õ–¨–¢–ê–¢!** üöÄ
